REST API 接口定义



<!-- TOC -->

- [接口说明](#接口说明)
- [设备创建](#设备创建)
    - [URL](#url)
    - [请求](#请求)
    - [响应](#响应)
    - [样例](#样例)
- [设备创建批量接口](#设备创建批量接口)
    - [URL](#url-1)
    - [请求](#请求-1)
    - [响应](#响应-1)
    - [样例](#样例-1)
- [消息下发](#消息下发)
    - [URL](#url-2)
    - [请求](#请求-2)
    - [响应](#响应-2)
    - [样例](#样例-2)
- [消息通知](#消息通知)
    - [URL](#url-3)
    - [请求](#请求-3)
    - [响应](#响应-3)
    - [样例](#样例-3)
- [错误码](#错误码)
- [其他样例](#其他样例)

<!-- /TOC -->



# 接口说明
 - 字符编码 - utf8编码
 - 请求方法 - http post
 - 数据交换协议 - json
 - 类型string - 长度为存储字节数，一个中文字符一般占用三个字节
 - 类型int -  为4字节（32bit）整型
 -  `$host` - rtio服务部署后的主机地址
 -  `$notifyurl` - rtio通知消息到第三方服务地址
 -  `$reporturl` - rtio上报消息到第三方服务地址



# 设备创建

## URL
`$host`/manage/create_device

## 请求
  
|名称       |类型  |最大长度|必选 | 描述|
|:----------|:------|:---|:-|:---|:-----|
| nonce     |string |32  |是|随机字符串，标识一次请求，两次请求不能相同|

## 响应

当http响应码为200，返回以下报文。

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| device_id     |string |64  |是|设备标识|
| device_key    |string |64  |是|设备密钥|
| code          |int    |-   |是|返回值: 1000-成功，其他参见错误码描述部分|
| desc          |string |128 |是|错误描述|



## 样例
 ```
 curl  --data '{"nonce":"112233"}' "http://192.168.50.196:8095/manage/create_device"
 ```

# 设备创建批量接口

## URL
`$host`/manage/create_device_batch

## 请求
  
|名称       |类型  |最大长度|必选 | 描述|
|:----------|:------|:---|:-|:---|:-----|
| nonce     |string |32  |是|随机字符串，标识一次请求，两次请求不能相同|
| device_num|int    |-   |否|创建设备数量，取值范围1-1000 |

## 响应

当http响应码为200，返回以下报文。

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| code          |int    |-   |是|返回值: 1000-成功，其他参见错误码描述部分|
| desc          |string |128 |是|错误描述|
| devices       |array |1000 |是|设备信息列表，每个设备详细信息如下表|

设备信息详情。
|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-|:-----------|:--------------|
| device_id     |string |64  |是|设备标识|
| device_key    |string |64  |是|设备密钥|


## 样例
 ```
 ```

# 消息下发

## URL
`$host`/call/send

## 请求
  
|名称       |类型  |最大长度|必选 | 描述|
|:----------|:------|:---|:-|:---|:-----|
| nonce     |string |32  |是|随机字符串，标识一次请求，两次请求不能相同|
| device_id |string |64  |是|设备标识|
| message   |string |512|是|消息内容 |
| time_live |int    |-   |否|消息有效秒数，默认10秒，最大60秒 |

## 响应

当http响应码为200，返回以下报文。

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| code          |int    |-   |是|返回值: 1000-成功，其他参见错误码描述部分|
| desc          |string |128 |是|错误描述|
| device_id     |string |64  |是|设备标识|
| device_status |int    |-   |否|设备状态: 0-未知，1-在线，2-离线|
| device_code   |int    |-   |否|设备接收到请求处理后返回值|
| device_message|string |512|否|设备接收到请求处理后返回消息|

## 样例
 ```
 curl -i "http://192.168.50.95:8090/call/send" --data '{"nonce":"12344", "device_id": "Device001", "message":"goodgoodbbb"}'
 ```

# 消息通知

## URL
`$reporturl`

## 请求
  
|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-|:-----------|:--------------|
| nonce         |string |32  |是|随机字符串，标识一次请求，两次请求不能相同|
| device_id     |string |64  |是|设备标识|
| device_message|string |2048|是|设备上报消息|


## 响应

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| code          |int    |-   |是|返回值: 1000-成功接收report，其他-继续回调（2，4，8，16... 共回调10次）|


## 样例
 ```
 curl  --data '{\"deviceid\":\"device001\"}' "http://192.168.50.95:8090/api?seq=123459"
 ```
# 错误码

| code |描述        |备注|
|:-----|:-----------|:------------|
|1000  |成功        ||
|1999  |失败        ||




# 其他样例



win10 curl注意单引号和双引号
 
 ```
 curl.exe  --data '{\"deviceid\":\"device001\"}' "http://192.168.50.95:8090/api?seq=123459"
 ```