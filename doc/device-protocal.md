
<!-- TOC -->

- [消息类型](#消息类型)
- [消息头](#消息头)
- [上报消息](#上报消息)
    - [请求](#请求)
    - [应答](#应答)
- [下发消息](#下发消息)
    - [请求](#请求-1)
    - [应答](#应答-1)
- [鉴权消息](#鉴权消息)
    - [请求](#请求-2)
    - [应答](#应答-2)
- [心跳消息](#心跳消息)
    - [请求](#请求-3)
    - [应答](#应答-3)

<!-- /TOC -->

# 消息类型
- 1 - 上报消息请求
- 2 - 上报消息响应
- 3 - 下发消息请求
- 4 - 下发消息响应
- 5 - 鉴权请求 
- 6 - 鉴权响应 
- 7 - 心跳PING
- 8 - 心跳PONG
  
# 消息头
|序列               |名称           |范围   | 必选|描述|
|:------------------|:--------------|:------|:---|:------|
| byte0[bit7-bit4]  |version        |0-15   |是  |协议版本|
| byte0[bit3-bit0]  |type           |0-15   |是  |[消息类型](#消息类型)|
| byte1 \| byte2    |id             |0-65535|是  |消息标识|
| byte3 \| byte4    |body_length    |1-1024 |是  |消息长度|

一次通信，resp和req header中的id必须相等。

# 上报消息
## 请求
|序列(body部分)              |名称      |范围   | 必选|描述|
|:------------------|:--------|:------|:---|:-----------|
| byte5...          |req_data     |       |是  |消息数据,最大1024 bytes|


## 应答
|序列(body部分)     |名称      |范围   | 必选|描述|
|:------------------|:---------|:------|:---|:-----------|
| byte5             |resp_code |0-255|是  |错误码|


# 下发消息
## 请求
|序列(body部分)      |名称      |范围   | 必选|描述|
|:------------------|:--------|:------|:---|:-----------|
| byte5...          |req_data     |       |是  |消息数据,最大1024 bytes|


## 应答
|序列(body部分)      |名称       |范围   | 必选|描述|
|:------------------|:-----------|:------|:---|:-----------|
| byte5             |resp_code   |0-255|是  |错误码|
| byte5 \| byte6    |resp_data_length  |1-1021       |否  |响应数据长度|
| byte8...          |resp_data  |       |否  |响应数据最大1021 bytes|

# 鉴权消息
## 请求
|序列(body部分)      |名称      |范围   | 必选|描述|
|:------------------|:--------|:------|:---|:-----------|
| byte5...          |req_data |       |否  |设备id:key|


## 应答
|序列(body部分)     |名称      |范围   | 必选|描述|
|:------------------|:--------|:------|:---|:-----------|
| byte5             |resp_code   |0-255|是  |错误码 0x11-鉴权成功|

# 心跳消息
## 请求
|序列(body部分)      |名称      |范围   | 必选|描述|
|:------------------|:--------|:------|:---|:-----------|
| byte5|byte6          |timeout   |300-65535|是  |心跳间隔，服务端检测超过1.5个timeout时长没收到数据则认为客户端断开|


## 应答
|序列(body部分)     |名称      |范围   | 必选|描述|
|:------------------|:--------|:------|:---|:-----------|
| byte5             |code   |0-255|是  |错误码 0x11-鉴权成功|
