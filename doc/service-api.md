REST API 接口定义



<!-- TOC -->

- [接口说明](#接口说明)
- [设备创建](#设备创建)
  - [URL](#url)
  - [请求](#请求)
  - [响应](#响应)
  - [样例](#样例)
- [消息下发](#消息下发)
  - [URL](#url-1)
  - [请求](#请求-1)
  - [响应](#响应-1)
  - [样例](#样例-1)
- [消息通知](#消息通知)
  - [URL](#url-2)
  - [请求](#请求-2)
  - [响应](#响应-2)
  - [样例](#样例-2)
- [错误码](#错误码)
- [注意事项](#注意事项)

<!-- /TOC -->



# 接口说明
 - app-service与rtio-service部署在同一个内网，使用http进行交互
 - 字符编码 - utf8编码
 - 请求方法 - http post
 - 数据交换协议 - json
 - 类型string - 长度为存储字节数，一个中文字符一般占用三个字节
 - 类型int -  为4字节（32bit）整型
 -  `$host` - rtio服务部署后的主机地址
 -  `$notifyurl` - rtio通知消息到第三方服务地址



# 设备创建

## URL
`$host`:8095/manage/create_device

## 请求
  
|名称       |类型  |最大长度|必选 | 描述|
|:----------|:------|:---|:---|:-----|
| nonce     |string |32  |是|随机字符串，标识一次请求，每次请求不能相同|

## 响应

当http响应码为200，返回以下报文。

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| device_id     |string |64  |是|设备标识|
| device_key    |string |64  |是|设备密钥|
| code          |int    |-   |是|返回值: 1000-成功，其他参见错误码描述部分|
| desc          |string |128 |是|错误描述|



## 样例
请求：
 ```
curl  --data '{"nonce":"1724578899"}' "http://192.168.50.196:8095/manage/create_device"
```
应答：
```
{"code":1000,"desc":"SUCCESS","device_id":"f5d97609924c4ccdb600bbd240c50a0a","device_key":"uPKyYFlGH6Qzccmw5mkz_JngIJ8","nonce":"1724578899"}
 ```



# 消息下发

## URL
`$host`:8090/call/send

## 请求
  
|名称       |类型  |最大长度|必选 | 描述|
|:----------|:------|:---|:---|:-----|
| nonce     |string |32  |是|随机字符串，标识一次请求，每次请求不能相同|
| device_id |string |64  |是|设备标识|
| message   |string |512|是|消息内容 |
| time_live |int    |-   |否|消息有效秒数，默认6秒，最大30秒 |

## 响应

当http响应码为200，返回以下报文。

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| code          |int    |-   |是|返回值: 1000-成功，其他参见错误码描述部分|
| desc          |string |128 |是|错误描述|
| device_id     |string |64  |是|设备标识|
| device_status |int    |-   |否|设备状态: 0-未知，1-在线，2-离线|
| device_code   |int    |-   |否|设备接收到请求处理后返回值|
| device_message|string |512|否|设备接收到请求处理后返回消息|

## 样例

请求：
 ```
curl "http://192.168.50.196:8090/call/send" --data '{"nonce":"157789243", "device_id": "4ffffb282b774b1fa1942b76445131d7", "message":"this dispatch message"}'
```
应答：
```
{"code":1000,"desc":"SUCCESS","device_code":1000,"device_id":"4ffffb282b774b1fa1942b76445131d7","device_message":"this a device message","device_status":1,"nonce":"157789243"}
 ```

# 消息通知

## URL
`$reporturl`

## 请求
  
|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-----------|:--------------|
| nonce         |string |32  |是|随机字符串，标识一次请求，每次请求不能相同|
| device_id     |string |64  |是|设备标识|
| device_message|string |1024|是|设备上报消息|


## 响应

|名称           |类型  |最大长度|必选|描述|
|:--------------|:------|:---|:-----------|:--------------|
| nonce         |string |32  |是|请求时带的随机字符串|
| code          |int    |-   |是|返回值: 1000-成功接收report数据，其他-继续回调（2，4，8，16... 共回调10次）*（重试功能暂未实现）*|


## 样例

收到请求：
 ```
{"device_id":"4ffffb282b774b1fa1942b76445131d7","device_message":"this a device message","nonce":"6832472384370018048"}
 ```
回复应答：
```
{"nonce":"6832472384370018048", "code": 1000}
```

# 错误码

| code |描述        |备注|
|:-----|:-----------|:------------|
|1000  |成功            ||
|1600  |URI无效         ||
|1601  |HTTP Body无效   ||
|1602  |HTTP METHOD 错误||
|1603  |JSON解析失败        ||
|1604  |JSON字段无效        ||
|1605  |设备不存在        ||
|2305  |消息下发失败        ||
|2705  |创建设备失败        ||

# 注意事项

win10 下curl双引号要转义，如下样例：
 ```
 curl.exe  --data '{\"deviceid\":\"device001\"}' "http://192.168.50.95:8090/api?seq=123459"
 ```